---
title: Confluentとは
summary: 概要説明
authors:
  - A.Tomita 
date: 2019-06-07
---

# Confluent の説明

Confluent社が作成したイベントストリームを処理するためのプラットフォームです。  
実体は、Apache Kafkaとそれを使いやすくするためのツール(サーバ)から構成されており
作成するシステムに対して、ツールを取捨選択して利用します。

# Kafkaの説明

Apache プロジェクトの一つで、プログラム間でメッセージ（データ）のやり取りを中継する
ソフトウェアです。
秒間数十万～数百万を超えるメッセージに対しても十分耐えうるつくりになっており
この量のメッセージを処理するときに取りこぼしなく（キューあふれがない）100%メッセージの
処理をすることが特徴で、データハブやストリーミングアプリケーションで利用されます。

## 比喩で説明すると

すこし難しく書きましたが、ちょっとイメージつきにくい人も多いと思います。
そこで、身近なところと合わせた形で比喩的に説明します。

社内で物を購入する場合の購入申請書ってありますよね。
この申請書が全て通るまでの話で例えます。
申請書は、社員が作成、係長承認、課長承認、部長承認のあと購買を通して物品を
購入する場合を想定します。

作成、承認、購入っといった処理は、Kafka以外のプログラミングが担い
申請書の書類の受け渡しをKafkaが行うイメージです。

申請書を、次の人に渡す場合をもう少し詳細に考えてみましょう。
係長承認を行うために書類を渡す場合です。

係長が仕事が空いていて、渡した書類をすぐに受け取って処理することはできますか？  
答えは、状況によります。他の仕事をしていれば処理することはできませんよね。
そこで、どうするかと言えば、たいていの人は、係長の机の上の書類ボックスに
書類を入れますよね。そして、係長の手が空いたタイミングで書類ボックスから
申請書を取り、中身を確認して、却下or承認を決めることになるでしょう。

このケースの、申請書が Kafkaで受け渡しをするメッセージで
この書類ボックスが、Kafkaの役割になります。

Kafkaは、例のように受け取ったメッセージを一時的に保管します。
そして、渡したい相手（プログラム）が処理できる段階で、Kafkaにメッセージを取りに行くことで
中継を行っています。
ここで注目すべきは、メッセージを受け取るプログラムが必要なタイミングでメッセージを受け取れることで、
例えば、前の処理が重く遅延している場合は、メッセージを一時保管してくれますし、
処理待ちのメッセージが1件もない場合は直ちにプログラムへメッセージを渡しシームレスにメッセージを処理できる
ことが特徴です。

また、書類の例で初めに書いた通り、複数の承認者へ渡っているように、
一つの事柄を処理するためには、複数のプログラムへメッセージを渡す必要があるため
何度もKafkaを経由して処理されるため、数倍から数十倍のメッセージが発生します。
うちの会社のシステムでは秒間数十万なんてメッセージを処理することないと思った人もいるかもしれませんが
意外と社内全部のメッセージの数を合わせるとと多いことがあり、
適用可能なシーンは多いです。


# Confluent コンポーネント

Apache Kafkaを利用したシステムを構築する際に
周辺のプログラムを全て作ると大きな工数がかかります。
そこで、半分出来上がったConfluentのツールを利用することで開発工数が大幅に
縮小することができます。
ここでは、主なConfluentのコンポーネントを紹介します。

## Kafka クライアンツ

Apache Kafkaに対してメッセージのやり取りを行うライブラリはJavaでしか
提供していません。ConfluentのKafka ClinetはC/C++,Go,Python,.netから
直接Kafkaに対してメッセージをやり取りが可能なライブラリを提供します。
既存のプログラムを流用を容易にしたり、開発者の得意な言語を利用可能になるため
開発工数削減に大きく貢献します。

## REST プロキシ 

HTTPを利用したREST Fullインターフェース経由で、Kafkaのメッセージをやり取りするためのサーバで、
Kafka Clinetで提供されていない言語からでもREST API経由で簡単に
メッセージのやり取りができるようになります。
これにより、実質言語の制約はなくなり、どのような言語であっても
Kafkaが利用可能になりました。

（注意事項）
REST API用にフォーマットを修正する必要があるため
既存プログラムのREST APIから、メッセージのやり取りができるものではありません。

## スキーマレジストリ

Kafkaで利用するメッセージフォーマットを管理するためのレジストリです。
この機能を利用すると、一つのメッセージストリームに対して、複数の種類のデータを流すことができたり
メッセージの後方互換を実現することができます。

例えば、複数のプログラムからメッセージを集めるような場合に送信メッセージフォーマット変更が
発生しても、一斉バージョンアップを必要とせず新旧混在環境で利用を可能にすることができます。
これは、IoTなどを利用したシステムでは非常に有益です。


## Kafka コネクター

既存システムで扱っているメッセージ（レコード）は、ファイルやデータベースなどに
保存されています。これらの、ファイルやデータベースにあるレコードを
Kafkaのメッセージに変換してくれるのが、Kafkaコネクターです。
これにより、既存のデータの利活用時に新たなプログラム開発をせずに
簡単な設定だけで実現することができます。

対応しているデータは、Confluentハブからアドオンで増やすことができ
実に様々なデータとメッセージの相互変換を行うことができるようになります。



